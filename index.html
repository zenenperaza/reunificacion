<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Personalización de Tema</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            transition: background-color 0.3s ease;
        }
    </style>
</head>

<body data-layout-color="light" data-leftbar-color="dark" data-topbar-color="dark" data-leftbar-size="default" data-leftbar-position="fixed" data-layout-size="fluid" data-layout-mode="default">

<!-- Aquí va el HTML de personalización -->
<!-- Pega el código HTML del panel derecho aquí (ya corregido con radio buttons) -->

<!-- Incluye Bootstrap y dependencias -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Aquí va el script de ThemeCustomizer -->
<script>
    class ThemeCustomizer {
        constructor() {
            this.body = document.body;
            this.defaultConfig = {
                leftbar: { color: 'dark', size: 'default', position: 'fixed' },
                layout: { color: 'light', size: 'fluid', mode: 'default' },
                topbar: { color: 'dark' },
                sidebar: { user: true }
            }
        }

        saveThemeToLocalStorage() {
            localStorage.setItem('themeConfig', JSON.stringify(this.config));
        }

        initConfig() {
            let config = localStorage.getItem('themeConfig');
            this.config = config ? JSON.parse(config) : JSON.parse(JSON.stringify(this.defaultConfig));

            this.body.setAttribute('data-leftbar-color', this.config.leftbar.color);
            this.body.setAttribute('data-leftbar-size', this.config.leftbar.size);
            this.body.setAttribute('data-leftbar-position', this.config.leftbar.position);
            this.body.setAttribute('data-layout-color', this.config.layout.color);
            this.body.setAttribute('data-layout-size', this.config.layout.size);
            this.body.setAttribute('data-layout-mode', this.config.layout.mode);
            this.body.setAttribute('data-topbar-color', this.config.topbar.color);
            if (this.config.sidebar.user.toString() === 'true') this.body.setAttribute('data-sidebar-user', true);
            else this.body.removeAttribute('data-sidebar-user');

            this.setSwitchFromConfig();
        }

        changeValue(area, key, val) {
            this.config[area][key] = val;
            this.body.setAttribute(`data-${area}-${key}`, val);
            this.setSwitchFromConfig();
            this.saveThemeToLocalStorage();
        }

        changeSidebarUser(val) {
            this.config.sidebar.user = val;
            if (val) this.body.setAttribute('data-sidebar-user', true);
            else this.body.removeAttribute('data-sidebar-user');
            this.saveThemeToLocalStorage();
        }

        resetTheme() {
            localStorage.removeItem('themeConfig');
            location.reload();
        }

        initSwitchListener() {
            const self = this;
            const listen = (name, area, key) => {
                document.querySelectorAll(`input[name=${name}]`).forEach(el => {
                    el.addEventListener('change', () => self.changeValue(area, key, el.value));
                });
            };

            listen('layout-color', 'layout', 'color');
            listen('layout-size', 'layout', 'size');
            listen('leftbar-color', 'leftbar', 'color');
            listen('leftbar-size', 'leftbar', 'size');
            listen('leftbar-position', 'leftbar', 'position');
            listen('topbar-color', 'topbar', 'color');

            document.querySelectorAll('input[name=sidebar-user]').forEach(el => {
                el.addEventListener('change', () => self.changeSidebarUser(el.checked));
            });

            document.querySelector('#resetBtn')?.addEventListener('click', () => self.resetTheme());
        }

        setSwitchFromConfig() {
            document.querySelectorAll('.right-bar input[type=radio], .right-bar input[type=checkbox]').forEach(el => el.checked = false);
            const c = this.config;
            const check = (name, val) => {
                const el = document.querySelector(`input[name=${name}][value="${val}"]`);
                if (el) el.checked = true;
            };

            check('layout-color', c.layout.color);
            check('layout-size', c.layout.size);
            check('leftbar-color', c.leftbar.color);
            check('leftbar-size', c.leftbar.size);
            check('leftbar-position', c.leftbar.position);
            check('topbar-color', c.topbar.color);
            if (c.sidebar.user.toString() === 'true') document.querySelector('input[name=sidebar-user]')?.checked = true;
        }

        init() {
            this.initConfig();
            this.initSwitchListener();
        }
    }

    window.addEventListener('DOMContentLoaded', () => new ThemeCustomizer().init());
</script>
</body>
</html>
